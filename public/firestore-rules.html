<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Firestore Rules Copier</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 0; background: #f8fafc; color: #0f172a; }
    .wrap { max-width: 800px; margin: 0 auto; padding: 16px; }
    .card { background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.04); }
    h1 { font-size: 18px; margin: 0 0 8px; }
    p { font-size: 14px; color: #475569; margin: 0 0 12px; }
    textarea { width: 100%; height: 360px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12px; padding: 12px; border: 1px solid #e5e7eb; border-radius: 10px; background: #0b1020; color: #e2e8f0; }
    .row { display: flex; gap: 8px; margin: 12px 0; }
    .btn { appearance: none; border: 0; background: #2563eb; color: #fff; padding: 10px 14px; border-radius: 10px; font-weight: 700; font-size: 14px; }
    .btn.alt { background: #0f172a; }
    .btn:active { transform: translateY(1px); }
    .note { font-size: 12px; color: #6b7280; }
    .ok { color: #16a34a; font-weight: 700; margin-inline-start: 8px; }
  </style>
  <meta name="color-scheme" content="light" />
  <meta name="theme-color" content="#2563eb" />
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Ù‚ÙˆØ§Ø¹Ø¯ Firestore Ø§Ù„Ø¬Ø§Ù‡Ø²Ø©</h1>
      <p>Ø§Ù†Ù‚Ø± â€œÙ†Ø³Ø®â€ Ù„Ù†Ø³Ø® Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ØŒ Ø£Ùˆ â€œØªÙ†Ø²ÙŠÙ„â€ Ù„Ø­ÙØ¸ Ù…Ù„Ù rules Ø¹Ù„Ù‰ Ù‡Ø§ØªÙÙƒ.</p>
      <div class="row">
        <button class="btn" id="copyBtn">ğŸ“‹ Ù†Ø³Ø®</button>
        <a class="btn alt" id="downloadBtn" href="/firestore.rules.txt" download>â¬‡ï¸ ØªÙ†Ø²ÙŠÙ„</a>
        <span id="done" class="ok" hidden>ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“</span>
      </div>
      <textarea id="rules" readonly>
// Simple, safe Firestore rules for VÃ¤gVÃ¤nner
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isSignedIn() { return request.auth != null; }
    function isOwner(userId) { return isSignedIn() && request.auth.uid == userId; }
    function isParty() {
      return isSignedIn() && (
        request.auth.uid == resource.data.userId ||
        request.auth.uid == resource.data.counterpartyId
      );
    }
    function isPartyNew() {
      return isSignedIn() && (
        request.auth.uid == request.resource.data.userId ||
        request.auth.uid == request.resource.data.counterpartyId
      );
    }

    match /rides/{rideId} {
      allow read: if true;
      allow create: if isSignedIn() && request.resource.data.userId == request.auth.uid;
      allow update, delete: if isSignedIn() && request.auth.uid == resource.data.userId;
    }

    match /bookings/{bookingId} {
      allow read: if isParty();
      allow create: if isPartyNew() && request.resource.data.userId == request.auth.uid;
      allow update: if isParty();
      allow delete: if isParty();
    }

    match /notifications/{id} {
      allow read: if isSignedIn()
        && request.auth.token.email != null
        && request.auth.token.email == resource.data.userEmail;
      allow create: if isSignedIn();
      allow update: if isSignedIn()
        && request.auth.token.email != null
        && request.auth.token.email == resource.data.userEmail;
      allow delete: if false;
    }

    match /users/{userId} {
      allow read, create, update, delete: if isOwner(userId);
    }

    match /contact_unlock/{id} {
      allow read: if isParty();
      allow create: if isSignedIn() && request.resource.data.userId == request.auth.uid;
      allow update, delete: if isParty();
    }

    match /{document=**} { allow read, write: if false; }
  }
}
      </textarea>
      <p class="note">Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Firebase Console â†’ Firestore Database â†’ RulesØŒ Ø£Ù„ØµÙ‚ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø«Ù… Ø§Ø¶ØºØ· Publish.</p>
    </div>
  </div>
  <script>
    (function(){
      const btn = document.getElementById('copyBtn');
      const done = document.getElementById('done');
      const ta = document.getElementById('rules');
      btn.addEventListener('click', async () => {
        try {
          ta.select();
          ta.setSelectionRange(0, ta.value.length);
          await navigator.clipboard.writeText(ta.value);
          done.hidden = false;
          setTimeout(()=>{ done.hidden = true; }, 1500);
        } catch (e) {
          // Fallback: create a hidden input to trigger copy on iOS
          const tmp = document.createElement('input');
          tmp.value = ta.value;
          document.body.appendChild(tmp);
          tmp.select();
          tmp.setSelectionRange(0, 99999);
          document.execCommand('copy');
          document.body.removeChild(tmp);
          done.hidden = false;
          setTimeout(()=>{ done.hidden = true; }, 1500);
        }
      });
    })();
  </script>
</body>
</html>

